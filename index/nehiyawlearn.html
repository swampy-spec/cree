<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cree Word Database</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Flashcard flip logic */
        .card-inner {
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .asset-img {
            max-width: 80px;
            max-height: 80px;
            width: auto;
            height: auto;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body class="bg-neutral-50 min-h-screen font-sans">
    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-6">
            <div class="flex items-center gap-4">
                <div class="bg-emerald-800 p-3 rounded-2xl text-white shadow-lg">
                    <i data-lucide="book-open" size="32"></i>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-neutral-900">Cree Word Database</h1>
                    <p class="text-neutral-500 font-medium">Interactive study guide</p>
                </div>
            </div>

            <div class="relative group w-full lg:w-96">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400" size="18"></i>
                <input 
                    type="text" 
                    id="search-input"
                    placeholder="Search English or Cree..."
                    class="w-full pl-12 pr-4 py-3 bg-white border border-neutral-200 rounded-2xl shadow-sm focus:ring-2 focus:ring-emerald-500 outline-none transition-all"
                >
            </div>
        </header>

        <!-- Categories Bar -->
        <div id="categories-bar" class="flex gap-2 mb-10 overflow-x-auto pb-4 no-scrollbar">
            <!-- Buttons generated by JS -->
        </div>

        <!-- Word Grid -->
        <div id="word-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            <!-- Cards generated by JS -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-32 bg-white rounded-3xl border border-neutral-100">
            <p class="text-neutral-400 text-lg">No results found.</p>
        </div>

        <footer class="mt-20 py-8 border-t border-neutral-200 text-center">
            <div id="stats-footer" class="flex flex-wrap justify-center gap-4 text-neutral-400 text-[10px] mb-4 uppercase tracking-widest font-bold">
                <!-- Stats updated by JS -->
            </div>
            <p class="text-neutral-500 text-sm italic">"nêhiyawêwin: Keeping the language alive."</p>
        </footer>
    </div>

    <script>
        const apiKey = "";
        const CREE_DATA = [
            // Numbers
            { id: 1, english: "One", cree: "pēyak", category: "Numbers", hash: "9f8e53c578f542a1b844ee4ca24ae4a2511e84d8", file: "1 Peyak.m4a" },
            { id: 2, english: "Two", cree: "nīso", category: "Numbers", hash: "fe9615d1f325f02ca06aff6496d830910a8d161a", file: "2 Niso.m4a" },
            { id: 3, english: "Three", cree: "nisto", category: "Numbers", hash: "fe9615d1f325f02ca06aff6496d830910a8d161a", file: "3 Nisto.m4a" },
            { id: 4, english: "Four", cree: "nēwo", category: "Numbers", hash: "caf0d7a296a658a89f2abb984d1e12da224e44b1", file: "4 Newo.m4a" },
            { id: 5, english: "Five", cree: "niyānan", category: "Numbers", hash: "8117cd8a09a247c7d63fe1440870e274b6676e47", file: "5 niyānan.m4a" },
            { id: 6, english: "Six", cree: "nikotwâsik", category: "Numbers", hash: "d10ebd6739f52f4f429f026599bcc7f0a2da70cd", file: "6 Nikotwâsik.m4a" },
            { id: 7, english: "Seven", cree: "tēpakohp", category: "Numbers", hash: "f9cb97105a8054fd7035c7cc78ad1a3ca6286e9a", file: "7-tépakohp.m4a" },
            { id: 8, english: "Eight", cree: "ayinānēw", category: "Numbers", hash: "e4478531849680f61d4cc1e8d9d5996603dce2b5", file: "8-ayinānēw.m4a" },
            { id: 9, english: "Nine", cree: "kēkā-mitātaht", category: "Numbers", hash: "85c89f0e01490aa2f3eb910f13230e2f178e42f9", file: "9-kēkā-mitātaht.m4a" },
            { id: 10, english: "Ten", cree: "mitātaht", category: "Numbers", hash: "3110b959ef49aaf0d52bd1601fe972081541939b", file: "10-mitātaht..m4a" },
            // Greetings
            { id: 11, english: "Hello", cree: "Tansi", category: "Greetings", hash: "f8737f0127dc5f21dd0f8851e7800d2525a4d6d4", file: "Tansi (Hello).m4a" },
            { id: 12, english: "How are you?", cree: "Tansi Kiya", category: "Greetings", hash: "f8737f0127dc5f21dd0f8851e7800d2525a4d6d4", file: "Tansi Kiya (how are you).m4a" },
            { id: 13, english: "Welcome", cree: "tatawaw", category: "Greetings", hash: "f8737f0127dc5f21dd0f8851e7800d2525a4d6d4", file: "Welcome tatawaw.m4a" },
            { id: 14, english: "Come on in", cree: "pihtikwê", category: "Greetings", hash: "f8737f0127dc5f21dd0f8851e7800d2525a4d6d4", file: "Come on in. pihtikwe..m4a" },
            { id: 15, english: "I am fine", cree: "namôya nânitaw", category: "Greetings", hash: "f8737f0127dc5f21dd0f8851e7800d2525a4d6d4", file: "I am fine. namoya nânitaw.m4a" },
            { id: 16, english: "Sit down", cree: "Api", category: "Greetings", hash: "f8737f0127dc5f21dd0f8851e7800d2525a4d6d4", file: "Api (Sit down).m4a" },
            
            // Birds & Animals (Updated with assets and orthography)
            { id: 17, english: "Crow", cree: "âhâsiw", category: "Birds & Animals", hash: "71a66547212d392f03d9d01e018e870dbcf88f71", file: "Ahasiw (Crow).m4a", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/Crow.svg" },
            { id: 18, english: "Blackbird", cree: "cahcahkâyow", category: "Birds & Animals", hash: "a05087e715daa28e8654ab47dffc9b68164c46af", file: "Cahcahkayow (Black Bird).m4a", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/Blackbird.svg" },
            { id: 19, english: "Eagle", cree: "kihew", category: "Birds & Animals", hash: "1f810d9c321cec9debab685bf5a47a774bb4e6a8", file: "Kihew (Eagle).m4a", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/eagle.svg" },
            { id: 20, english: "Blue jay", cree: "kwîhkwîsiw", category: "Birds & Animals", hash: "3a81193e8ca7499482bca9487046c3fbbbe19feb", file: "Kwihkwisiw (Blue Jay).m4a", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/blue%20jay.svg" },
            { id: 21, english: "Loon", cree: "makwa", category: "Birds & Animals", hash: "81a3bc1eaf69e64c1c3eaf3ed9a1ade89ad7dee4", file: "Makwa (Loon).m4a" }, // No asset in snippet
            { id: 22, english: "Goose", cree: "niska", category: "Birds & Animals", hash: "53e6c8561e563d67fcbcb7a946aa8d9cef1ee980", file: "Niska. (Goose)m4a", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/goose.svg" },
            { id: 23, english: "Thunderbird", cree: "pihêsiw", category: "Birds & Animals", hash: "65c15e5851fd6e92ba03c4c762d240623703ed99", file: "Pihesiw (Thunderbird).m4a", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/thunderbird.svg" },
            { id: 24, english: "Duck", cree: "sîsîp", category: "Birds & Animals", hash: "119303c0ad77110aa9bfafb8b6b6cc3cef7e83ff", file: "Sisip (Duck).m4a", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/duck.svg" },
            { id: 25, english: "Whiskey Jack", cree: "wiskycak", category: "Birds & Animals", hash: "bc23f032d37de3572f2cb584d252f1c1da4c4c4b", file: "Wiskycak (Whiskey Jack).m4a" },
            
            { id: 101, english: "Bear", cree: "maskwa", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/bear.svg" },
            { id: 102, english: "Wolf", cree: "mahihkan", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/wolf.svg" },
            { id: 103, english: "Moose", cree: "môswa", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/moose.svg" },
            { id: 104, english: "Caribou", cree: "atihkwawak", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/caribou.svg" },
            { id: 105, english: "Horse", cree: "mistatim", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/horse.svg" },
            { id: 106, english: "Buffalo", cree: "paskwa mostos", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/buffalo.svg" },
            { id: 107, english: "Badger", cree: "mistanask", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/badger.svg" },
            { id: 108, english: "Coyote", cree: "mêstacâkanis", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/coyote.svg" },
            { id: 109, english: "Deer", cree: "wâwâskêsiw", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/deer.svg" },
            { id: 110, english: "Fox", cree: "mahkêsîs", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/fox.svg" },
            { id: 111, english: "Skunk", cree: "sâkwês", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/skunk.svg" },
            { id: 112, english: "Pig", cree: "kohkôs", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/pig.svg" },
            { id: 113, english: "Mouse", cree: "wâpakosîs", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/mouse.svg" },
            { id: 114, english: "Porcupine", cree: "kâkwa", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/porcupine.svg" },
            { id: 115, english: "Rabbit", cree: "wâpos", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/rabbit.svg" },
            { id: 116, english: "Squirrel", cree: "anikwacâs", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/squirrel.svg" },
            { id: 117, english: "Weasel", cree: "sihkos", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/weasel.svg" },
            { id: 118, english: "Frog", cree: "ayîkis", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/frog.svg" },
            { id: 119, english: "Beaver", cree: "amisk", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/beaver.svg" },
            { id: 120, english: "Cat", cree: "minôs", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/cat.svg" },
            { id: 121, english: "Dog", cree: "atim", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/dog.svg" },
            { id: 122, english: "Cow", cree: "mostos", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/cow.svg" },
            { id: 123, english: "Sheep", cree: "mâyatihk", category: "Birds & Animals", asset: "https://raw.githubusercontent.com/swampy-spec/gif/main/sheep.svg" },

            // Values
            { id: 26, english: "Thankfulness", cree: "Ataminawin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Ataminawin Thankfulness.m4a" },
            { id: 27, english: "Determination", cree: "Ahkameyihtamowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Ahkameyihtamowin Determination.m4a" },
            { id: 28, english: "Perseverance", cree: "Ahkameymowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Ahkameymowin perseverance.m4a" },
            { id: 29, english: "Happiness", cree: "Ewiyitikosihk", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Ewiyitikosihk Happiness.m4a" },
            { id: 30, english: "Tolerance", cree: "Isahowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Isahowin Tolerance.m4a" },
            { id: 31, english: "Wisdom", cree: "Iyinisiwin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Iyinisiwin wisdom.m4a" },
            { id: 32, english: "Cleanliness", cree: "Kanacihowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Kanacihowin Cleanliness.m4a" },
            { id: 33, english: "Ultimate Protection", cree: "Kanawayimikisowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Kanawayimikisowin (ultimate protection).m4a" },
            { id: 34, english: "Courage", cree: "Kasohkeymohk", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Kasohkeymohk courage.m4a" },
            { id: 35, english: "Respect", cree: "Kihcheyihtakosiwin", category: "Values", hash: "e31b62a52d733d1265c4f4a61f5fd9fa94ef18b8", file: "Kihcheyihtakosiwin (respect).m4a" },
            { id: 36, english: "Respect (Action)", cree: "Kisehitowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Kisehitowin Respect.m4a" },
            { id: 37, english: "Kindness", cree: "Kisewatisiwin", category: "Values", hash: "e31b62a52d733d1265c4f4a61f5fd9fa94ef18b8", file: "Kisewatisiwin (kindness).m4a" },
            { id: 38, english: "Courtesy", cree: "Kweyask Kanihtawicitasohk", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Kweyask Kanihtawicitasohk Courtesy.m4a" },
            { id: 39, english: "Honesty", cree: "Kweyaskitisowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Kweyaskitisowin (honesty).m4a" },
            { id: 40, english: "Care For Each Other", cree: "Manacihitowin", category: "Values", hash: "e31b62a52d733d1265c4f4a61f5fd9fa94ef18b8", file: "Manacihitowin (take care of each other).m4a" },
            { id: 41, english: "Gentle", cree: "Manatisiwin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Manatisiwin Gentle.m4a" },
            { id: 42, english: "Trust", cree: "Manisitotakewin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Manisitotakewin Trust.m4a" },
            { id: 43, english: "Honour", cree: "Mistahi kistehitowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Mistahi kistehitowin honour.m4a" },
            { id: 44, english: "Generosity", cree: "Miyote Nisokamakewin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Miyote Nisokamakewin Generosity.m4a" },
            { id: 45, english: "Consideration", cree: "Nakatecikewin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Nakatecikewin consideration.m4a" },
            { id: 46, english: "Responsibility", cree: "Nakateyihcikewin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Nakateyihcikewin responsibility.m4a" },
            { id: 47, english: "Obedience", cree: "Nanahihtimowim", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Nanahihtimowim Obedience.m4a" },
            { id: 48, english: "Friendliness", cree: "Ototemihtowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Ototemihtowin Friendliness.m4a" },
            { id: 49, english: "Sharing", cree: "Pahkwenamatowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Pahkwenamatowin Sharing.m4a" },
            { id: 50, english: "Hope", cree: "Pakoseymowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Pakoseymowin Hope.m4a" },
            { id: 51, english: "Peaceful", cree: "Payahtik Ayawin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Payahtik Ayawin peaceful.m4a" },
            { id: 52, english: "Forgiveness", cree: "Poneyhitimowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Poneyhitimowin forgiveness.m4a" },
            { id: 53, english: "Love", cree: "Sakitowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Sakitowin Love.m4a" },
            { id: 54, english: "Patience", cree: "Sasisipihkeytamowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Sasisipihkeytamowin patience.m4a" },
            { id: 55, english: "Strength of Mind", cree: "Sohkeyihtomowin", category: "Values", hash: "ebcc8a976935fc64a3ee7fbfd182823e921c8cd8", file: "Sohkeyihtomowin Strenght of mind.m4a" },
            { id: 56, english: "Humility", cree: "Tapahteyimowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Tapahteyimowin Humility.m4a" },
            { id: 57, english: "Faith", cree: "Tapowakeyihtamowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Tapowakeyihtamowin Faith.m4a" },
            { id: 58, english: "Cooperation", cree: "Wacewakanihtowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Wacewakanihtowin Cooperation.m4a" },
            { id: 59, english: "Relationship", cree: "Wahkotowin", category: "Values", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Wahkotowin Relationship.m4a" },
            // Seasons
            { id: 60, english: "Spring", cree: "Miyoskamin", category: "Seasons", hash: "2f776bec534faf0912646256cdc4095d0dc6786b", file: "Miyoskamin (spring).m4a" },
            { id: 61, english: "Summer", cree: "Nîpon", category: "Seasons", hash: "2f776bec534faf0912646256cdc4095d0dc6786b", file: "Nîpon (summer).m4a" },
            { id: 62, english: "Fall", cree: "Takwakin", category: "Seasons", hash: "2f776bec534faf0912646256cdc4095d0dc6786b", file: "Takwakin (fall).m4a" },
            { id: 63, english: "Winter", cree: "Pipon", category: "Seasons", hash: "2f776bec534faf0912646256cdc4095d0dc6786b", file: "Pipon (Winter).m4a" },
            // Misc
            { id: 64, english: "Heart", cree: "Mihtay", category: "Misc", hash: "e31b62a52d733d1265c4f4a61f5fd9fa94ef18b8", file: "Mihtay (heart).m4a" },
            { id: 65, english: "Child Rearing", cree: "Ohpikihawasowin", category: "Misc", hash: "888a7356d7d703d2dc33076312a7d28d00c668de", file: "Ohpikihawasowin Child Rearing.m4a" },
            { id: 66, english: "Pink", cree: "Wapikwaniwinakwan", category: "Misc", hash: "e31b62a52d733d1265c4f4a61f5fd9fa94ef18b8", file: "Wapikwaniwinakwan (pink).m4a" },
            { id: 67, english: "Friend", cree: "Wichewakan", category: "Misc", hash: "e31b62a52d733d1265c4f4a61f5fd9fa94ef18b8", file: "Wichewakan (friend).m4a" }
        ];

        const CATEGORIES = ["All", "Greetings", "Numbers", "Birds & Animals", "Values", "Seasons", "Misc"];
        
        let searchTerm = "";
        let activeCategory = "All";
        let loadingId = null;

        function updateIcons() {
            lucide.createIcons();
        }

        function pcmToWav(pcmData, sampleRate = 24000) {
            const buffer = new ArrayBuffer(44 + pcmData.length);
            const view = new DataView(buffer);
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i));
            };
            writeString(0, 'RIFF');
            view.setUint32(4, 32 + pcmData.length, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, pcmData.length, true);
            new Uint8Array(buffer, 44).set(new Uint8Array(pcmData));
            return new Blob([buffer], { type: 'audio/wav' });
        }

        async function playTTS(text) {
            const payload = {
                contents: [{ parts: [{ text: `Say clearly in Cree: ${text}` }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                const base64Audio = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                if (base64Audio) {
                    const binaryString = atob(base64Audio);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i);
                    const audio = new Audio(URL.createObjectURL(pcmToWav(bytes)));
                    return audio.play();
                }
            } catch (e) { console.error("TTS Fallback failed", e); }
        }

        async function playAudio(word) {
            if (!word.hash || !word.file) {
                return playTTS(word.cree);
            }

            const cardElement = document.getElementById(`card-${word.id}`);
            const spinner = cardElement.querySelector('.audio-spinner');
            const icon = cardElement.querySelector('.audio-icon');
            
            spinner.classList.remove('hidden');
            icon.classList.add('hidden');

            const rawUrl = `https://raw.githubusercontent.com/swampy-spec/audio/${word.hash}/${encodeURIComponent(word.file)}`;
            
            try {
                const audio = new Audio(rawUrl);
                await new Promise((resolve, reject) => {
                    audio.oncanplaythrough = resolve;
                    audio.onerror = () => reject(new Error("File not found"));
                    audio.src = rawUrl;
                    audio.load();
                    setTimeout(() => reject(new Error("Timeout")), 3000);
                });
                await audio.play();
            } catch (err) {
                console.warn(`Original clip for "${word.cree}" not reachable. Using AI fallback.`);
                await playTTS(word.cree);
            } finally {
                spinner.classList.add('hidden');
                icon.classList.remove('hidden');
            }
        }

        function renderCategories() {
            const container = document.getElementById('categories-bar');
            container.innerHTML = CATEGORIES.map(cat => `
                <button 
                    onclick="setCategory('${cat}')"
                    class="px-5 py-2.5 rounded-xl whitespace-nowrap text-sm font-bold transition-all ${
                        activeCategory === cat 
                        ? 'bg-emerald-700 text-white shadow-md transform scale-105' 
                        : 'bg-white text-neutral-600 border border-neutral-200 hover:bg-emerald-50'
                    }"
                >
                    ${cat}
                </button>
            `).join('');
        }

        function renderGrid() {
            const container = document.getElementById('word-grid');
            const emptyState = document.getElementById('empty-state');
            
            const filteredWords = CREE_DATA.filter(word => {
                const matchesSearch = word.english.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                     word.cree.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = activeCategory === "All" || word.category === activeCategory;
                return matchesSearch && matchesCategory;
            });

            if (filteredWords.length === 0) {
                container.innerHTML = "";
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                container.innerHTML = filteredWords.map(word => `
                    <div 
                        id="card-${word.id}"
                        class="card relative h-56 w-full cursor-pointer perspective-1000"
                        onclick="handleCardClick(this, ${word.id})"
                    >
                        <div class="card-inner relative w-full h-full preserve-3d">
                            <!-- Front side (English) -->
                            <div class="absolute inset-0 bg-white rounded-2xl shadow-sm flex flex-col items-center justify-center border border-neutral-200 backface-hidden p-4 hover:border-emerald-200 transition-colors">
                                <span class="text-[10px] uppercase tracking-widest text-emerald-600 font-bold mb-2 bg-emerald-50 px-2 py-1 rounded">
                                    ${word.category}
                                </span>
                                <h2 class="text-xl font-semibold text-neutral-800 text-center">${word.english}</h2>
                                ${word.asset ? `<img src="${word.asset}" class="asset-img" alt="${word.english}">` : ''}
                            </div>

                            <!-- Back side (Cree) -->
                            <div class="absolute inset-0 bg-emerald-800 rounded-2xl shadow-md flex flex-col items-center justify-center border border-emerald-900 rotate-y-180 backface-hidden text-white p-4">
                                <span class="text-[10px] uppercase tracking-widest opacity-70 font-bold mb-2">nêhiyawêwin</span>
                                <h2 class="text-2xl font-bold mb-4 text-center leading-tight">${word.cree}</h2>
                                
                                <div class="flex items-center gap-2">
                                    <div class="bg-white/20 p-2 rounded-full">
                                        <div class="audio-spinner hidden animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>
                                        <div class="audio-icon">
                                            <i data-lucide="volume-2" size="20"></i>
                                        </div>
                                    </div>
                                    ${word.hash ? `
                                        <a 
                                            href="https://github.com/swampy-spec/audio/commit/${word.hash}" 
                                            target="_blank" 
                                            rel="noopener noreferrer"
                                            onclick="event.stopPropagation()"
                                            class="p-2 bg-white/10 rounded-full hover:bg-white/20"
                                            title="View in Repository"
                                        >
                                            <i data-lucide="external-link" size="14"></i>
                                        </a>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                updateIcons();
            }

            document.getElementById('stats-footer').innerHTML = `
                <span>${CREE_DATA.length} Words Loaded</span>
                <span>•</span>
                <span>Primary: Repository Audio</span>
                <span>•</span>
                <span>Secondary: Gemini TTS Fallback</span>
            `;
        }

        window.setCategory = (cat) => {
            activeCategory = cat;
            renderCategories();
            renderGrid();
        };

        window.handleCardClick = (element, id) => {
            const isFlipped = element.classList.contains('flipped');
            if (!isFlipped) {
                const word = CREE_DATA.find(w => w.id === id);
                playAudio(word);
            }
            element.classList.toggle('flipped');
        };

        document.getElementById('search-input').addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderGrid();
        });

        window.onload = () => {
            renderCategories();
            renderGrid();
        };
    </script>
</body>
</html>
